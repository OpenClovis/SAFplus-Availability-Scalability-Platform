# Makefile to generate html and pdf doc for wiki-based documents

ifndef DOCCONFIG
DOCCONFIG := ../tools/docconfig_clovis.sh
endif


.PHONY: all html pdf init

all: pdf html

init:
	mkdir -p ../html/$(DOCID)
	mkdir -p ../pdf
	sed -e "s/DOCID=/DOCID=$(DOCID)/g" \
        -e "s/DOCTITLE=/DOCTITLE=\"$(DOCTITLE)\"/g" \
        -e "s/WIKI_URL=/WIKI_URL=$(DOCURL)/g" \
        -e "s/INPUT_WIKI_FORMAT=/INPUT_WIKI_FORMAT=$(INPUT_WIKI_FORMAT)/g" \
        -e "s/HTMLDIR=/HTMLDIR=\.\.\/html\/$(DOCID)/g" \
        -e "s/PARTNUMBER=/PARTNUMBER=$(PARTNUMBER)/g" $(DOCCONFIG) > docconfig_temp1.sh
	source docconfig_temp1.sh; \
	cp ../tools/Doxyfile_clovis . ; \
	grep -v "$(DOCID)" Doxyfile_clovis | \
	   	sed "s/[$$]docname[$$]/$(DOCID)/g" > Doxyfile; \
	PROJECT_NUMBER="Release $$RELEASE - rev$$REVISION"; \
	if [ "$(BUILD_NUMBER)" ]; then \
	    PROJECT_NUMBER="$$PROJECT_NUMBER - build $(BUILD_NUMBER)"; \
	fi; \
	sed -e "s/^PROJECT_NUMBER\\s*=/PROJECT_NUMBER = \"$$PROJECT_NUMBER\"/g" Doxyfile > Doxyfile.mod

pdf: init
	sed -e "s/OUTPUT_HTML_FORMAT=/OUTPUT_HTML_FORMAT=singlepage/g" \
	        docconfig_temp1.sh > docconfig_temp2.sh    
	../tools/convert_wiki_to_html_pdf.sh -c docconfig_temp2.sh

html: init
	sed -e "s/OUTPUT_HTML_FORMAT=/OUTPUT_HTML_FORMAT=$(OUTPUT_HTML_FORMAT)/g" \
	        docconfig_temp1.sh > docconfig_temp3.sh    
	../tools/convert_wiki_to_html_pdf.sh -c docconfig_temp3.sh -p
