from string import Template

scriptTemplate = Template("""
#!/bin/bash
#
# This file is Auto generated by OpenClovis IDE
# Copyright (C) 2009-2010 OpenClovis
#
# This file is free; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 2 of the License, or (at your option) any later version.
#
# This file is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# Author(s): OpenClovis
#

echo "`date`: $0 $*"

CMD=$1

MODEL=${modelname}
COMP=${appname}

LOGDIR=/var/opt/${COMP}
RUNDIR=/var/run/${COMP}
BIN=/opt/${MODEL}/${COMP}
PIDFILE="/var/run/${SA_AMF_COMPONENT_NAME}".pid

export SA_AMF_HEALTHCHECK_KEY="${appname}"

mkdir -p $RUNDIR
mkdir -p $LOGDIR

cleanup()
{
	if test -f $PIDFILE; then
		PID=`cat $PIDFILE`
		kill $PID 2> /dev/null
		rm $PIDFILE
	fi
}

instantiate()
{
	if [ ! -x $BIN ]; then
		logger -s -t $0 "ERROR: File $BIN does not exist or is not executable"
		exit 1
	fi

	cleanup

	$BIN $* >> ${LOGDIR}/${SA_AMF_COMPONENT_NAME}.log 2>&1 &

	echo $! > $PIDFILE
}

case "$CMD" in
	instantiate)
		instantiate $*
		;;
	cleanup)
		cleanup $*
		;;
	*)
		echo "Usage: $0 {instantiate|cleanup}"
		exit 1
esac

exit 0
""")
